<!doctype html>
<html lang="en" class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="canonical" href="https://html5-templates.com/" />
    <title>Yapp</title>
    <meta name="description" content="Simple HTML5 Page layout template with header, footer, sidebar etc.">

    <!-- <link rel="stylesheet" href="./assets/css/style.css">-->
    <link rel="stylesheet" href="assets/css/spapp.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/custom.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

    <script src="assets/js/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="assets/js/jquery.spapp.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.js"></script>

    <!-- Custom JS -->
    <!-- REMOVE this line -- <script src="assets/js/form-validation.js"></script> -->
    
    <!-- Ajax Calls JS -->
    <script src="assets/js/script.js"></script>

</head>

<body>
    <!-- Navigation -->
    <header>
        <nav role="navigation">
            <nav id="navbar" class="navbar bg-body-tertiary navbar-edit">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#dashboard">
                        <img src="assets/images/canvas.png" alt="Yapp Logo" height="40">
                    </a>
                    <form class="d-flex align-items-center" role="search">
                        <div class="dropdown me-3">
                            <button class="btn" id="appMenuBtn" data-bs-toggle="dropdown" aria-expanded="false" style="width: 36px; height: 36px; background: #fff; border: 1.5px solid #e6e9f2; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(220,53,69,0.04); cursor: pointer; transition: background 0.15s, border-color 0.15s;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 6h18" stroke="#dc3545" stroke-width="1.5" stroke-linecap="round"/>
                                    <path d="M3 12h18" stroke="#dc3545" stroke-width="1.5" stroke-linecap="round"/>
                                    <path d="M3 18h18" stroke="#dc3545" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="appMenuBtn">
                                <li><a class="dropdown-item" href="#profile">Profile</a></li>
                                <li><button id="openPostModalBtn" class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#writePostModal">Make Post</button></li>
                                <li><a class="dropdown-item" href="#explore-communities">Communities</a></li>
                            </ul>
                        </div>
                        <button type="button" class="btn btn-outline-danger button-login fw-bold" onclick="UserService.logout()">
                            Sign Out
                        </button>
                    </form>
                </div>
            </nav>
        </nav>
    </header>


<section id="pageContent">
    <main id="spapp" role="main">
        <section id="login" data-load="login.html"></section>
        <section id="signup" data-load="signup.html"></section>
        <section id="dashboard" data-load="dashboard.html"></section>
        <section id="profile" data-load="profile.html"></section>
        <section id="post" data-load="post.html"></section>
        <section id="community" data-load="community.html"></section>
        <section id="explore-communities" data-load="explore-communities.html"></section>
        <section id="my-communities" data-load="my-communities.html"></section>
        <section id="community-post" data-load="community-post.html"></section>
        <section id="admin" data-load="admin.html"></section>
        <section id="edit-profile" data-load="edit-profile.html"></section>


            </main>
    </section>

    <!-- Write Post Modal -->
    <div class="modal fade" id="writePostModal" tabindex="-1" role="dialog" aria-labelledby="writePostModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="writePostModalLabel">Write a Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="createPostForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="title" placeholder="Post title..." maxlength="100" required>
                        </div>
                        <div>
                            <textarea class="form-control" name="content" rows="5" maxlength="500" placeholder="What's on your mind? (max 500 characters)" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Post</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Post Modal -->
    <div class="modal fade" id="editPostModal" tabindex="-1" role="dialog" aria-labelledby="editPostModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editPostModalLabel">Edit Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editPostForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="title" placeholder="Post title..." maxlength="100" required>
                        </div>
                        <div>
                            <textarea class="form-control" name="content" rows="5" maxlength="500" placeholder="Post content..." required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Community Modal -->
    <div class="modal fade" id="createCommunityModal" tabindex="-1" aria-labelledby="createCommunityLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createCommunityLabel">Create community</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="createCommunityForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="communityName" class="form-label">Community name</label>
                            <input type="text" class="form-control" id="communityName" name="name" required maxlength="80" />
                        </div>
                        <div class="mb-3">
                            <label for="communityDesc" class="form-label">Short description</label>
                            <input type="text" class="form-control" id="communityDesc" name="shortDescription" maxlength="160" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Community Post Modal -->
    <div class="modal fade" id="createCommunityPostModal" tabindex="-1" aria-labelledby="createCommunityPostLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createCommunityPostLabel">Create Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="createCommunityPostForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="title" placeholder="Post title..." maxlength="100" required>
                        </div>
                        <div>
                            <textarea class="form-control" name="content" rows="5" maxlength="500" placeholder="What's on your mind?" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Post</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Community Post Modal -->
    <div class="modal fade" id="editCommunityPostModal" tabindex="-1" aria-labelledby="editCommunityPostLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editCommunityPostLabel">Edit Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editCommunityPostForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <input type="text" class="form-control" name="title" placeholder="Post title..." maxlength="100" required>
                        </div>
                        <div>
                            <textarea class="form-control" name="content" rows="5" maxlength="500" placeholder="Post content..." required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Community Modal -->
    <div class="modal fade" id="editCommunityModal" tabindex="-1" aria-labelledby="editCommunityLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editCommunityLabel">Edit Community</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="editCommunityForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="editCommunityName" class="form-label">Community name</label>
                            <input type="text" class="form-control" id="editCommunityName" name="name" required maxlength="80" />
                        </div>
                        <div class="mb-3">
                            <label for="editCommunityDesc" class="form-label">Short description</label>
                            <input type="text" class="form-control" id="editCommunityDesc" name="description" maxlength="160" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Update</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- My Communities Create Modal -->
    <div class="modal fade" id="mycommCreateCommunityModal" tabindex="-1" aria-labelledby="mycommCreateCommunityLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="mycommCreateCommunityLabel">Create community</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="mycommCreateCommunityForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="mycommCommunityName" class="form-label">Community name</label>
                            <input type="text" class="form-control" id="mycommCommunityName" name="name" required maxlength="80" />
                        </div>
                        <div class="mb-3">
                            <label for="mycommCommunityDesc" class="form-label">Short description</label>
                            <input type="text" class="form-control" id="mycommCommunityDesc" name="shortDescription" maxlength="160" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer>
    </footer>

    <!-- REMOVE this line --<script src="./assets/js/ajax-calls.js"></script> -->
    <script src="utils/constants.js"></script>
    <script src="utils/rest-client.js"></script>
    <script src="utils/utils.js"></script>
    <script src="services/user-service.js"></script>
    <script src="services/auth-service.js"></script>
    <script src="services/post-service.js"></script> 
    <script src="services/comment-service.js"></script>
    <script src="services/like-service.js"></script>
    <script src="services/community-service.js"></script>
    <script src="services/community-post-service.js"></script>
    <script src="services/community-like-service.js"></script>
    <script src="services/community-comment-service.js"></script>
    <script src="services/admin-service.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
    // Handle create post form submission
    $("#createPostForm").on("submit", function(e) {
        e.preventDefault();
        const title = $(this).find('input[name="title"]').val().trim();
        const content = $(this).find('textarea[name="content"]').val().trim();
        
        if (title && content) {
            PostService.createPost(title, content);
        } else {
            toastr.error("Please fill in all fields");
        }
    });

    // Handle edit post form submission
    $("#editPostForm").on("submit", function(e) {
        e.preventDefault();
        const postId = $("#editPostModal").data('post-id');
        const title = $(this).find('input[name="title"]').val().trim();
        const content = $(this).find('textarea[name="content"]').val().trim();
        
        if (title && content && postId) {
            PostService.updatePost(postId, title, content);
        } else {
            toastr.error("Please fill in all fields");
        }
    });

    // Handle create community form submission
    $("#createCommunityForm").on("submit", function(e) {
        e.preventDefault();
        const name = $(this).find('input[name="name"]').val().trim();
        const description = $(this).find('input[name="shortDescription"]').val().trim();
        
        if (name) {
            CommunityService.createCommunity(name, description, function(response) {
                $("#createCommunityModal").modal('hide');
                $("#createCommunityForm")[0].reset();
                
                // Reload communities if on explore page
                if (window.location.hash.includes('explore-communities')) {
                    loadExploreCommunities();
                }
            });
        } else {
            toastr.error("Please enter a community name");
        }
    });

    // Handle create community post form submission
    $("#createCommunityPostForm").on("submit", function(e) {
        e.preventDefault();
        const title = $(this).find('input[name="title"]').val().trim();
        const content = $(this).find('textarea[name="content"]').val().trim();
        const communityId = sessionStorage.getItem('currentCommunityId');
        
        if (title && content && communityId) {
            CommunityPostService.createCommunityPost(communityId, title, content, function(response) {
                $("#createCommunityPostModal").modal('hide');
                $("#createCommunityPostForm")[0].reset();
                
                // Reload community posts
                if (typeof loadCommunityDetail === 'function') {
                    loadCommunityDetail();
                }
            });
        } else {
            toastr.error("Please fill in all fields");
        }
    });

    // Handle edit community post form submission
    $("#editCommunityPostForm").on("submit", function(e) {
        e.preventDefault();
        const postId = $("#editCommunityPostModal").data('post-id');
        const title = $(this).find('input[name="title"]').val().trim();
        const content = $(this).find('textarea[name="content"]').val().trim();
        
        if (title && content && postId) {
            CommunityPostService.updateCommunityPost(postId, title, content, function(response) {
                $("#editCommunityPostModal").modal('hide');
                
                // Reload page
                if (typeof loadCommunityDetail === 'function') {
                    loadCommunityDetail();
                } else if (typeof loadCommunityPostDetail === 'function') {
                    loadCommunityPostDetail();
                }
            });
        } else {
            toastr.error("Please fill in all fields");
        }
    });

    // Handle edit community form submission
    $("#editCommunityForm").on("submit", function(e) {
        e.preventDefault();
        const communityId = $("#editCommunityModal").data('community-id');
        const name = $(this).find('input[name="name"]').val().trim();
        const description = $(this).find('input[name="description"]').val().trim();
        
        if (name && communityId) {
            CommunityService.updateCommunity(communityId, name, description, function(response) {
                $("#editCommunityModal").modal('hide');
                
                // Reload page
                if (typeof loadMyCommunities === 'function') {
                    loadMyCommunities();
                } else if (typeof loadCommunityDetail === 'function') {
                    loadCommunityDetail();
                }
            });
        } else {
            toastr.error("Please enter a community name");
        }
    });

    // Handle my communities create form submission
    $("#mycommCreateCommunityForm").on("submit", function(e) {
        e.preventDefault();
        const name = $(this).find('input[name="name"]').val().trim();
        const description = $(this).find('input[name="shortDescription"]').val().trim();
        
        if (name) {
            CommunityService.createCommunity(name, description, function(response) {
                $("#mycommCreateCommunityModal").modal('hide');
                $("#mycommCreateCommunityForm")[0].reset();
                
                // Reload my communities
                if (typeof loadMyCommunities === 'function') {
                    loadMyCommunities();
                }
            });
        } else {
            toastr.error("Please enter a community name");
        }
    });
    </script>
</body>

</html>